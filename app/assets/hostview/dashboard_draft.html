<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SB Admin - Bootstrap Admin Template</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/sb-admin.css" rel="stylesheet">
	<!--D3 style sheet by D3 creator (not necessary)-->
	<link type="text/css" href="js/d3_style.css" rel="stylesheet" />
	<link type="text/css" rel="stylesheet" href="css/jquery.qtip.min.css" />
    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href="js/nv.d3.css" rel="stylesheet" type="text/css">
	<script src="js/D3.js"></script>
	<script src="js/jQuery.js"></script>
	<script src="js/nv.d3.js"></script>
    <script src="js/stream_layers.js"></script>
	<script src="https://cdn.jsdelivr.net/lodash/4.11.2/lodash.min.js"></script>
	<script src="js/jquery.qtip.min.js"></script>
	
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<style = "text/css">
		<!-- .tooltip {
			position: relative;
			display: inline-block;
			border-bottom: 1px dotted black;
		}

		.tooltip .tooltiptext {
			visibility: hidden;
			width: 120px;
			background-color: black;
			color: #fff;
			text-align: center;
			border-radius: 6px;
			padding: 5px 0;
			position: absolute;
			z-index: 1;
			bottom: 150%;
			left: 50%;
			margin-left: -60px;
		}

		.tooltip .tooltiptext::after {
			content: "";
			position: absolute;
			top: 100%;
			left: 50%;
			margin-left: -5px;
			border-width: 5px;
			border-style: solid;
			border-color: black transparent transparent transparent;
		}

		.tooltip:hover .tooltiptext {
			visibility: visible;
		} -->
		#favorite_app {
			font-size:10px;
		}
		#averagepc_time{
			font-size:10px;
		}
		#favorite_network{
			font-size:10px;
		}
		#traffic_summary{
			font-size:10px;
		}
		
		#pie1_container {
			height:300px;
		}
		#pie1_panel {
			height:350px;
		}
		#pie2_3_container {
			
			height:265px;
		}
		#pie2 {
			height: 260px;
			float:left;
			width: 50%;
		}
		#pie3 {
			height: 260px;
			float:left;
			width: 50%;
		}
		#bar1 {
			height: 280px;
		}
		#bar1_container {
			height: 300px;
		}
		#bar2 {
			height: 250px;
		}
		#bar2_container {
			height: 265px;
		}
		#bar3 {
			height: 250px;
		}
		#bar3_container {
			height: 265px;
		}
		.nvd3 .nv-pieLabels .nv-label text {
			fill: black !important;
			font-size:8px;
		}
		.nvd3 .nv-legend .nv-legend-text {
			fill:black;
			font-size:9px;
		}
		.nvd3 .nv-x .nv-axis .nv-axislabel {
			font-weight:bold;
		}
		.nvd3 .nv-y .nv-axis .nv-axislabel {
			font-weight:bold;
		}
		
		.nvd3.nv-pie .nv-pie-title {
			fill: black;
			font-size: 10px !important;
		}
	</style>

</head>

<body>
	
	
		

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="dashboard_draft.html">Hostview</a>
            </div>
            <!-- Top Menu Items -->
            <ul class="nav navbar-right top-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-envelope"></i> <b class="caret"></b></a>
                    <ul class="dropdown-menu message-dropdown">
                        <li class="message-preview">
                            <a href="#">
                                <div class="media">
                                    <span class="pull-left">
                                        <img class="media-object" src="http://placehold.it/50x50" alt="">
                                    </span>
                                    <div class="media-body">
                                        <h5 class="media-heading">
                                            <strong>John Smith</strong>
                                        </h5>
                                        <p class="small text-muted"><i class="fa fa-clock-o"></i> Yesterday at 4:32 PM</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur...</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="message-preview">
                            <a href="#">
                                <div class="media">
                                    <span class="pull-left">
                                        <img class="media-object" src="http://placehold.it/50x50" alt="">
                                    </span>
                                    <div class="media-body">
                                        <h5 class="media-heading">
                                            <strong>John Smith</strong>
                                        </h5>
                                        <p class="small text-muted"><i class="fa fa-clock-o"></i> Yesterday at 4:32 PM</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur...</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="message-preview">
                            <a href="#">
                                <div class="media">
                                    <span class="pull-left">
                                        <img class="media-object" src="http://placehold.it/50x50" alt="">
                                    </span>
                                    <div class="media-body">
                                        <h5 class="media-heading">
                                            <strong>John Smith</strong>
                                        </h5>
                                        <p class="small text-muted"><i class="fa fa-clock-o"></i> Yesterday at 4:32 PM</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur...</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="message-footer">
                            <a href="#">Read All New Messages</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-bell"></i> <b class="caret"></b></a>
                    <ul class="dropdown-menu alert-dropdown">
                        <li>
                            <a href="#">Alert Name <span class="label label-default">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-primary">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-success">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-info">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-warning">Alert Badge</span></a>
                        </li>
                        <li>
                            <a href="#">Alert Name <span class="label label-danger">Alert Badge</span></a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">View All</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i> John Smith <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#"><i class="fa fa-fw fa-user"></i> Profile</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-envelope"></i> Inbox</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-gear"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-power-off"></i> Log Out</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">
                    <li class="active">
                        <a href="dashboard_draft.html"><i class="fa fa-fw fa-dashboard"></i> My dashboard</a>
                    </li>
					<li>
                        <a href="javascript:;" data-toggle="collapse" data-target="#demo"><i class="fa fa-fw fa-bar-chart"></i> Details <i class="fa fa-fw fa-caret-down"></i></a>
                        <ul id="demo" class="collapse">
                            <li>
                                <a href="application.html"><i class="fa fa-fw fa-desktop"></i> Applications</a>
                            </li>
                            <li>
                                <a href="usage.html"><i class="fa fa-fw fa-clock-o"></i> Device Activity</a>
                            </li>
							<li>
                                <a href="networks.html"><i class="fa fa-fw fa-wifi"></i> Networks</a>
                            </li>
							<li>
                                <a href="traffic_summary.html"><i class="fa fa-fw fa-sliders"></i> Traffic Statistics</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </nav>

        <div id="page-wrapper">

            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <h2 class="page-header">
                            Dashboard
                            <small>Metrics</small>
                        </h2>
                        <!--<ol class="breadcrumb">
                            <li>
                                <i class="fa fa-dashboard"></i>  <a href="index.html">Dashboard</a>
                            </li>
                            <li class="active">
                                <i class="fa fa-file"></i> Dasboard Draft
                            </li>
                        </ol>-->
                    </div>
                </div>
                <!-- /.row -->
				 <div class="row">
                    <div class="col-lg-12">
                        <div class="alert alert-info alert-dismissable" id="alertbar">
                            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                            <i class="fa fa-info-circle"></i>  <strong>Last day we received data from you: </strong> 
                        </div>
                    </div>
                </div>
				<!-- /.row -->
				<div class="row">
					<div class="col-lg-3 col-md-1">
                        <div class="panel panel-primary" id="favorite_app_panel">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-xs-3">
                                        <i class="fa fa-desktop fa-3x"></i>
                                    </div>
                                    <div class="col-xs-9 text-left">
                                        <div>Favorite Application: </div>
										<div id="favorite_app"><strong></strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
					<div class="col-lg-3 col-md-1">
                        <div class="panel panel-green" id="averagepc_time_panel">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-xs-3">
                                        <i class="fa fa-clock-o fa-3x"></i>
                                    </div>
                                    <div class="col-xs-9 text-left">
                                        <div>Average PC Usage/Day: </div>
                                        <div id="averagepc_time"><strong></strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
					<div class="col-lg-3 col-md-1">
                        <div class="panel panel-yellow" id="favorite_network_panel">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-xs-3">
                                        <i class="fa fa-wifi fa-3x"></i>
                                    </div>
                                    <div class="col-xs-9 text-left">
                                        <div>Most Used Network: </div>
                                        <div id="favorite_network"><strong></strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
					<div class="col-lg-3 col-md-1">
                        <div class="panel panel-red" id="transmit_summary_panel">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-xs-2">
                                        <i class="fa fa-sliders fa-3x"></i>
                                    </div>
                                    <div class="col-xs-10 text-left">
                                        <div>Most Traffic Generated: </div>
                                        <div id="traffic_summary"><strong></strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
				</div>
				<!-- /.row -->
				<!-- /.row -->
				<div class="row">
                    <div class="col-lg-6">
						<div class="panel panel-primary">
							<div class="panel-heading" title="apps">
								<h3 class="panel-title"><i class="fa fa-desktop"></i> Applications used in the last week </h3>
								
							</div>
							<div class="panel-body" id="pie1_panel">
								<div class="flot-chart" id="pie1_container">
									<div class="flot-chart-content" id="pie1">
										<svg></svg>
									</div>
								</div>
								<div class="text-right">
                                    <a href="application.html">View Details <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
							</div>
						</div>
                    </div>
					<div class="col-lg-6">
                        <div class="panel panel-green">
                            <div class="panel-heading" title="usage">
                                <h3 class="panel-title"><i class="fa fa-clock-o"></i> Logged on VS Active Usage</h3>
                            </div>
                            <div class="panel-body">
                                <div class="flot-chart" id="bar1_container">
                                    <div class="flot-chart-content" id="bar1">
										<svg></svg>
									</div>
                                </div>
								<div class="text-right">
                                    <a href="usage.html">View Details <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
				</div>
				<!-- /.row -->
				<div class="row">
                    <div class="col-lg-6">
                        <div class="panel panel-yellow">
                            <div class="panel-heading" title="networks">
                                <h3 class="panel-title"><i class="fa fa-wifi"></i> Network's connected to in the last week </h3>
                            </div>
                            <div class="panel-body">
                                <div class="flot-chart" id="bar2_container">
                                    <div class="flot-chart-content" id="bar2">
										<svg></svg>
									</div>
                                </div>
								<div class="text-right">
                                    <a href="networks.html">View Details <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
					<div class="col-lg-6">
                        <div class="panel panel-red">
                            <div class="panel-heading" title="traffic">
                                <h3 class="panel-title"><i class="fa fa-sliders"></i> Traffic Volume by Application</h3>
                            </div>
                            <div class="panel-body">
                                <div id="pie2_3_container">
                                    <div class="flot-chart-content" id="pie2">
										<svg></svg>
									</div>
                                
								
                                    <div class="flot-chart-content" id="pie3">
										<svg></svg>
									</div>
                                </div>
								<div class="text-right">
                                    <a href="traffic_summary.html">View Details <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
				<!-- /.row -->
				<!--<div class="row">
					<div class="col-lg-3">
                        <div class="panel panel-primary">
                            <div class="panel-heading" data-tooltip="metric">
                                <h3 title="Pop" class="panel-title"><i class="fa fa-bar-chart-o"></i> Some Metric: </h3>
                            </div>
                            <div class="panel-body">
                                <div class="flot-chart" id="bar1_container">
                                    <div class="flot-chart-content" id="pie3">
										<svg></svg>
									</div>
                                </div>
                            </div>
                        </div>
                    </div>
				</div>
            </div>-->
            <!-- /.container-fluid -->

        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <!--<script src="js/jquery.js"></script>-->

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>
	<script type="text/javascript">
		/*$(document).ready(function(){
			$('[data-toggle="tooltip"]').tooltip();   
		});*/
		/*$('[title!=""]').mouseover(function(){
			console.log(this);
			$(this).qtip({
				content:{
					text:function(event,api){
						return $(this).attr('data-tip');
					}
				}
			});
		});*/
		$('[title="apps"]').qtip({
			content:{
				text:'Applications that were actively interacted with in the Foreground'
			},
			position: {
				my: 'bottom center',
				at:'top center',
				target: 'mouse'
			},
			style:{
				classes:'qtip-dark qtip-bootstrap'
			}
		});
		$('[title="networks"]').qtip({
			content:{
				text:'List of Networks connected to in the given time interval'
			},
			position: {
				my: 'bottom center',
				at:'top center',
				target: 'mouse'
			},
			style:{
				classes:'qtip-dark qtip-bootstrap'
			}
		});
		$('[title="usage"]').qtip({
			content:{
				text:'Duration that device has been logged into VS the duration that user has actively used the device'
			},
			position: {
				my: 'bottom center',
				at:'top center',
				target: 'mouse'
			},
			style:{
				classes:'qtip-dark qtip-bootstrap'
			}
		});
		$('[title="traffic"]').qtip({
			content:{
				text:'Comparison of traffic sent VS received by the top 10 applications'
			},
			position: {
				my: 'bottom center',
				at:'top center',
				target: 'mouse'
			},
			style:{
				classes:'qtip-dark qtip-bootstrap'
			}
		});
		
		
		var width = 280;
		var height = 380;
		var d1=new Date(2016,02,15);
		var d2;
		var days, hours, minutes, seconds;
		var format2= d3.time.format.utc("%Y-%m-%d");
		console.log(format2.parse("2016-03-31"));
		//var format3=d3.time.format("%H:%M:%S.%L");
		//console.log(format3.parse("51:15:18.966"));
		Number.prototype.toFixedDown = function(digits) {
			var re = new RegExp("(\\d+\\.\\d{" + digits + "})(\\d)"),
				m = this.toString().match(re);
			return m ? parseFloat(m[1]) : this.valueOf();
		};
		// auto-scaling bytes to kb,mb,gb,etc.
		function formatBytes(bytes,decimals) {
		   if(bytes == 0) return '0 Byte';
		   var k = 1000;
		   var dm = decimals + 1 || 3;
		   var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
		   var i = Math.floor(Math.log(bytes) / Math.log(k));
		   return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
		};
		// Formatting time into hours, minutes and seconds
		function formatTime(d) {
			var s='';
			var day = 60*60*24;
			var hour = 60*60;
			var minute = 60;
				//console.log(d);
			if(d/day>1){
				s = s + Math.floor(d/day) + " Days";
				d = d - Math.floor(d/day)*day;
			} 
			if(d/hour>1){
				s = s + " " + Math.floor(d/hour) + " Hours";
				d = d - Math.floor(d/hour)*hour;
			}
			if(d/minute>1){
				s = s + " " + Math.floor(d/minute) + " Minutes";
				d = d - Math.floor(d/minute)*minute;
			}
			// round seconds to 2 decimal places using toFixedDown	
			if(d > 0) {
				s = s + " " + d.toFixedDown(2) + " Seconds";
			}
			return s;
		
		};
		
		// sorting function
		function DataSortByName(a,b){
		  if (a.name < b.name)
			return -1;
		  else if (a.name > b.name)
			return 1;
		  else 
			return 0;
		}; 
		
		// Alerting the last day PC was used
		d3.json('offline_data/Dashboard_data/lastday_data_received.json', function(data){
			//console.log(data);
			//console.log(d3.keys(data));
			//console.log(data[0].lastdayofdata);
			//console.log(format2.parse(data[0].lastdayofdata));
			d2=format2.parse(data[0].lastdayofdata);
			//console.log(d2);
			days=data[0].day;
			hours=data[0].hour;
			minutes=data[0].minute;
			seconds=data[0].second;
			$("#adhir").html("Last day we received data from you: " + d2.toDateString());
			$("#alertbar strong").html("Last day we received data from you: " + d2.toDateString() + ", Total Data Collected: " + days + " days, "+hours+" hours, "+minutes+" minutes, and "+seconds+" seconds");
			//$("#datacollectinterval strong").html("Total Data: " + days + " days, "+hours+" hours, "+minutes+" minutes, and "+seconds+" seconds");
		});
		
		$("#datacollectinterval").css( "fontSize", "12px" );
		//$(".nvd3 nv-wrap nv-pieChart").css("transform","translate(-10px,30px)");
		
		// Pie Chart #1
		var sum=0;
		
		d3.json('offline_data/Dashboard_data/UserApp_interaction_ByApp.json', function(data){
			console.log("Success pie chart 1");
			//console.log(Object.keys(data));
			//console.log(data);
			var j=[];
			data.forEach(function(d,i){
				//console.log(d.label);
				//console.log(d.value);
				sum+=d.value;
				j.push(d.value);
			});
			//console.log(j);
			
					// determines the highest value
			var maxVal=d3.max(j);
			var minVal=d3.min(j);
			//favorite application
			//console.log(maxVal);
			function getlabelfromval(value) {
				var datalabel="";
				data.forEach(function(d,i){
					//console.log(value);
					//console.log(d.label);
					//console.log(d.value.toString());
					if (value===d.value) {
						datalabel = d.label.toString();
					}
				})
				return datalabel;
			}
			
			//var st1=_.findKey(data, { "value": maxVal });
			//console.log(st1);
			var st2="";
			st2=getlabelfromval(maxVal);
			console.log("label-st2=",st2);
			$("#favorite_app strong").html(st2);
			//console.log(data.entries());
			var scale = '';
			// create the scale
			if (maxVal>= 3600){
				scale='hours';
			} else if (maxVal<3600 && maxVal>=60){
				scale='minutes';
			} else {
				scale='seconds';
			}
			console.log("scale=", scale);
			//console.log(sum);
			
			nv.addGraph(function() {
				var chart = nv.models.pieChart()
					.x(function(d) { return d.label; })
					.y(function(d) { 
						switch (scale){
							case 'hours':
								return (d.value/3600.0);
								break;
							case 'minutes':
								return (d.value/60.0);
								break;
							case 'seconds':
								return d.value;
								break;
						}
					})
					//.width(width)
					//.height(height)
					.labelType('percent')
					//.valueFormat(d3.format('%'))
					.showLabels(true);
					
				//chart.showLegend(false);
				chart.labelSunbeamLayout(true);
				chart.legendPosition("top");
				//chart.labelsOutside(true);
				chart.donut(true);
				//chart.color(["#1f77b4","#ff7f0e","#2ca02c","#d62728","#e6550d","#8c564b","#e377c2","#7f7f7f","#393b79","#17becf"]);
				chart.color(["#ff7f0e","#102263","#2CA02C", "#d62728","#ffbb78", "#f7fe2e", "#142da9","#636363"]);
				chart.title("You Interacted With");
				chart.tooltip.enabled(true);
				chart.tooltip.contentGenerator(function (d) {
					var time=formatTime(d.data.value);
					//console.log(time);
					var html = "<h5 align='center'>Application: "+d.data.label+"</h5>";
					html+="<p>Usage: "+time+"</p>";
					return html;
				});

				d3.select("#pie1 svg")
				.datum(data)
				.transition().duration(350)
				//.attr('width', width)
				//.attr('height', height)
				.call(chart);
				
				chart.pie.dispatch.on("elementMouseover", function(e) {
						//console.log(e);
						//console.log($(this));
						//console.log(e.data);
						//loadsecondgraph(e.data);
						var label = e.data.label.slice(0,20);
						$('#pie1 .nv-pie-title').text(label);
						$('#pie1 .nv-pie-title').css("fontSize","10px");
						$('#pie1 .nv-pie-title').css("fill","black");
					});
				chart.pie.dispatch.on("elementMouseout", function(e) {
						//console.log(e);
						//console.log($(this));
						//console.log(e.data);
						//loadsecondgraph(e.data);
						/*var label = e.data.label.slice(0,20);
						$('.nv-pie-title').text(label);
						$('.nv-pie-title').css("fontSize","10px");
						$('.nv-pie-title').css("fill","black");*/
						$('#pie1 .nv-pie-title').text("You Interacted With");
					});
				chart.pie.dispatch.on("elementClick", function(e) {
						console.log(e);
						//console.log($(this));
						//console.log(e.data);
						//loadsecondgraph(e.data);
						/*var label = e.data.label.slice(0,20);
						$('.nv-pie-title').text(label);
						$('.nv-pie-title').css("fontSize","10px");
						$('.nv-pie-title').css("fill","black");*/
						//$('.nv-pie-title').text("You Interacted With");
					});
				return chart;
			});
		});
		
		// Bar Chart #1
		var width_bar = 500;
		var height_bar = 250;
		d3.json('offline_data/Dashboard_data/computeron_vs_computerused_bar.json', function(data){
			console.log("Success bar chart 1");
			// Put all the values from both keys (runtime, interacttime) in a variable called 'j' and find the highest value to determine scale
			var j=[];
			console.log("data=", data);
			//console.log(d3.keys(data));
			data.forEach(function(d,i){
				//console.log(d.key);
				//console.log(d.values);
				d.values.forEach(function(e,i){
					//console.log(e.label);
					j.push(e.value);
					
				});
			});
			console.log("max value, j=", j);
			// determines the highest value
			var maxVal=d3.max(j);
			var minVal=d3.min(j);
			var scale = '';
			// create the scale
			if (maxVal>= 3600){
				scale='hours';
			} else if (maxVal<3600 && maxVal>=60){
				scale='minutes';
			} else {
				scale='seconds';
			}
			console.log("scale= ", scale);
			// Average PC Usage
			function getaverageuse() {
				var sum=0.0;
				var avg=0.0;
				var counter = 0;
				data.forEach(function(d,i){
					//console.log(value);
					//console.log(d.label);
					//console.log(d.value.toString());
					d.values.forEach(function(e,i){
						//console.log(d.key);
						if (d.key=="ActivelyUsing"){
							sum+=e.value;
							counter+=1;
						}
					});
				})
				console.log("sum= ",sum);
				console.log("counter= ", counter);
				avg = sum/counter;
				return avg;
			}
			var av_usage=0.0;
			av_usage=getaverageuse().toFixedDown(3);
			console.log("av_usage= ",av_usage);
			var time_av_usage="";
			// convert the average time from seconds to readable time format
			time_av_usage=formatTime(av_usage);
			console.log("time_av_usage= ",time_av_usage);
			$("#averagepc_time strong").html(time_av_usage);
			var format = d3.time.format.utc("%Y-%m-%d");
			//console.log(format.parse("2016-03-15"));
			// Create and load chart
			nv.addGraph(function() {
				var chart = nv.models.multiBarChart()
					.x(function(d) { return format.parse(d.day); })
					.y(function(d) { 
						switch (scale){
							
							case 'hours':
								return (d.value/3600.0);
								break;
							case 'minutes':
								return (d.value/60.0);
								break;
							case 'seconds':
								
								return d.value;
								break;
						}
						})
					.margin({top: 30, right: 80, bottom: 60, left: 100})
					.showControls(false)        //Allow user to switch between "Grouped" and "Stacked" mode.
					//.height(height)
					.reduceXTicks(false)
					.staggerLabels(true); // Stagger labels
					//.rotateLabels(-45); // Or Rotate them 45 degrees

					chart.yAxis
						//.tickFormat(function(d){return milisecondsToComplete(d)}/*d3.format(',.2f')*/)
						.tickFormat(d3.format(',.2f'))
						.axisLabel('Time ('+scale+')');
					chart.xAxis
						.axisLabel('Days')
						.axisLabelDistance(15)
						.tickFormat(function(d){return d3.time.format.utc("%Y-%m-%d")(new Date(d));});
					/*var o = d3.scale.ordinal()
							.domain(["foo", "bar"])
							.range(["#1f77b4","#2ca02c"]);*/
					var color_array = ["#f7fe2e","#052645"];
					// Dynamic yAxis Range
					var upper_lim=0;
					if (scale=='hours') {
						maxVal=maxVal/3600;
						upper_lim=Math.floor(maxVal)+2;
					} else if (scale=='minutes') {
						maxVal=maxVal/60;
						upper_lim=Math.floor(maxVal)+10;
					} else if (scale=='seconds') {
						upper_lim=Math.floor(maxVal)+1000;
					}
					// logging upper_lim
					console.log("upper lim chart1=",upper_lim);
					// Force yAxis range
					chart.forceY([0,upper_lim]);
					/*chart.color(function(d,i){
						return color_array[i];
					});*/
					chart.color(["#ff7f0e","#102263","#2CA02C", "#d62728","#ffbb78", "#f7fe2e", "#142da9","#636363"]);
					chart.tooltip.enabled(true);
					// Tooltip formatting for easier readability
					chart.tooltip.contentGenerator(function (d) {
						//console.log(d);
						var time=formatTime(d.data.value);
						//console.log(time);
						var html = "<h5 align='center'>Series: "+d.data.key+"</h5>";
						html+="<p>Day: "+d.data.day+"</p>";
						html+="<p>Time: "+time+"</p>";
						return html;
					});
					
					
					d3.select('#bar1 svg')
						.datum(data)
						.transition().duration(500)
						.call(chart);

					nv.utils.windowResize(chart.update);
					
					chart.multibar.dispatch.on("elementClick", function(e) {
						console.log(e);
						console.log($(this));
						console.log(e.data);
						//loadsecondgraph(e.data);
					});

					return chart;
					
				});
			
		});
		
		// Bar Chart #2
		d3.json('offline_data/Dashboard_data/NetworkUsage_byDay.json', function(data){
			console.log("Success bar chart 2");
			// Put all the values from both keys (runtime, interacttime) in a variable called 'j' and find the highest value to determine scale
			var j=[];
			//console.log(data);
			//console.log(d3.keys(data));
			var network_names=[];
			data.forEach(function(d,i){
				//console.log(d.key);
				//console.log(d.values);
				network_names[i]=d.key;
				d.values.forEach(function(e,i){
					//console.log(e.label);
					j.push(e.value);
					
				});
			});
			console.log("max value, j=", j);
			//console.log(network_names);
			// determines the highest value
			var maxVal=d3.max(j);
			var minVal=d3.min(j);
			var scale = '';
			// create the scale
			if (maxVal>= 3600){
				scale='hours';
			} else if (maxVal<3600 && maxVal>=60){
				scale='minutes';
			} else {
				scale='seconds';
			}
			console.log("scale ", scale);
			// Add the total times from all the different networks (keys)
			
			function compareNetworks() {
				var net_number=d3.keys(data);
				//console.log(net_number);
				var sum=0.0;
				var network_total=[];
				for (var i=0;i<net_number.length;i+=1){
					network_total[net_number[i]]=0.0;
				}
				//console.log(network_total);
				data.forEach(function(d,i){

					d.values.forEach(function(e,j){
						//console.log(d.key);
						if (d.key==network_names[i]){
							network_total[i]+=e.value;
						}
					});
					
				});
				//console.log(network_total);
				//console.log(d3.max(network_total));
				var index=network_total.indexOf(d3.max(network_total));
				return network_names[index];
			}
			var best_network=compareNetworks();
			console.log("best network", best_network);
			$("#favorite_network strong").html(best_network);
			var format = d3.time.format.utc("%Y-%m-%d");
			//console.log(format.parse("2016-03-15"));
			// Create and load chart
			nv.addGraph(function() {
				var chart = nv.models.multiBarChart()
					.x(function(d) { return format.parse(d.day); })
					.y(function(d) { 
						switch (scale){
							
							case 'hours':
								return (d.value/3600.0);
								break;
							case 'minutes':
								return (d.value/60.0);
								break;
							case 'seconds':
								
								return d.value;
								break;
						}
						})
					.margin({top: 30, right: 50, bottom: 60, left: 70})
					.showControls(false)        //Allow user to switch between "Grouped" and "Stacked" mode.
					//.stacked(true)
					//.height(height)
					.reduceXTicks(false)
					.staggerLabels(true); // Stagger labels
					//.rotateLabels(-45); // Or Rotate them 45 degrees

					chart.yAxis
						//.tickFormat(function(d){return milisecondsToComplete(d)}/*d3.format(',.2f')*/)
						.tickFormat(d3.format(',.2f'))
						.axisLabel('Time ('+scale+')');
					chart.xAxis
						.axisLabel('Days')
						.axisLabelDistance(15)
						.tickFormat(function(d){return d3.time.format.utc("%Y-%m-%d")(new Date(d));});

					var color_array = ["#ff9d2a","#052645","#67aded"];
					// Dynamic yAxis Range
					var upper_lim=0;
					if (scale=='hours') {
						maxVal=maxVal/3600;
						upper_lim=Math.floor(maxVal)+2;
					} else if (scale=='minutes') {
						maxVal=maxVal/60;
						upper_lim=Math.floor(maxVal)+10;
					} else if (scale=='seconds') {
						upper_lim=Math.floor(maxVal)+1000;
					}
					// logging upper_lim
					console.log("upper lim chart2=",upper_lim);
					// Force yAxis range
					chart.forceY([0,upper_lim]);
					/*chart.color(function(d,i){
						return color_array[i];
					});*/
					chart.color(["#ff7f0e","#102263","#2CA02C", "#d62728","#ffbb78", "#f7fe2e", "#142da9","#636363"]);
					chart.tooltip.enabled(true);
					// Tooltip formatting for easier readability
					chart.tooltip.contentGenerator(function (d) {
						//console.log(d);
						var time=formatTime(d.data.value);
						//console.log(time);
						var html = "<h5 align='center'>"+d.data.key+"</h5>";
						html+="<p>Day: "+d.data.day+"</p>";
						html+="<p>Time: "+time+"</p>";
						return html;
					});
					
					d3.select('#bar2 svg')
						.datum(data)
						.transition().duration(500)
						.call(chart);

					nv.utils.windowResize(chart.update);
					
					chart.multibar.dispatch.on("elementClick", function(e) {
						console.log(e);
						console.log($(this));
						console.log(e.data);
						//loadsecondgraph(e.data);
					});

					return chart;
					
				});
			
		});
		
		// Pie Chart #2 & #3
		d3.json('offline_data/Dashboard_data/TrafficVolume_ByApp.json', function(data){
			console.log("Success bar chart 3");
			// Put all the values from both keys (runtime, interacttime) in a variable called 'j' and find the highest value to determine scale
			var j=[];
			var key=[];
			var r=[];
			var s=[];
			console.log(data);
			//console.log(d3.keys(data));
			data.forEach(function(d,i){
				//console.log(d.key);
				//console.log(d.values);
				key[i]=d.key;
				d.values.sort(DataSortByName);
				d.values.forEach(function(e,i){
					//console.log(e.label);
					j.push(e.value);
					if (d.key=="Traffic Sent") {
						//s_val.push(e.value);
						//var key1=e.name;
						//s[name]=e.name;
						s.push({
							name:e.name,
							value:e.value
						});
					} else if(d.key=="Traffic Received"){
						//r_val.push(e.value);
						//var key2=e.name;
						//r[name]=e.name;
						r.push({
							name:e.name,
							value:e.value
						});
					}
					
				});
			});
			console.log("j=",j);
			// determines the highest value
			var maxVal=d3.max(j);
			var minVal=d3.min(j);
			var scale = '';
			// create the scale
			if (maxVal>= 1000000000){
				scale='gigabytes';
			} else if (maxVal<1000000000 && maxVal>=1000000){
				scale='megabytes';
			} else {
				scale='kilobytes';
			}
			console.log("scale=",scale);
			function trafficGeneratedBy(){
				var sent="";
				var s=[];
				var received="";
				var r=[];
				var s_val=[];
				var r_val=[];
				
				data.forEach(function(d,i){
				//console.log(d.key);
				//console.log(d.values);
				//console.log(d.values[i]);
					d.values.forEach(function(e,i){
						//console.log(e.label);
						//j.push(e.value);
						if (d.key=="Traffic Sent") {
							s_val.push(e.value);
							//var key1=e.name;
							//s[name]=e.name;
							s.push({
								name:e.name,
								value:e.value
							});
						} else if(d.key=="Traffic Received"){
							r_val.push(e.value);
							//var key2=e.name;
							//r[name]=e.name;
							r.push({
								name:e.name,
								value:e.value
							});
						}
						
					});
				
				});
				console.log("s-max:",d3.max(s_val));
				console.log("r-max:",d3.max(r_val));
				console.log("s=",s);
				console.log("r=",r);
				for (i=0;i<s.length;i++){
					if(d3.max(s_val)==s[i].value){
						var sent=s[i].name;
						console.log("sent=",sent);
					}
				}
				for (i=0;i<r.length;i++){
					if(d3.max(r_val)==r[i].value){
						var received=r[i].name;
						console.log("received=",received);
					}
				}
				sent=sent.replace(/.exe/i,"");
				received=received.replace(/.exe/i,"");
				$("#traffic_summary strong").html("upload: "+sent+", download: "+received);
			}
			trafficGeneratedBy();
			var format = d3.time.format.utc("%Y-%m-%d");
			//console.log(format.parse("2016-03-15"));
			// Create and load chart
			// Create and load chart with First dataset
			nv.addGraph(function() {
				var chart = nv.models.pieChart()
					.x(function(d){return d.name;})
					.y(function(d){ 
						switch (scale){
							case 'gigabytes':
								return (d.value/1000000000.0);	//assuming data is in bytes
								break;
							case 'megabytes':
								return (d.value/1000000.0);	//assuming data is in bytes
								break;
							case 'kilobytes':
								return d.value/1000.0; //assuming data is in bytes
								break;
						
						}
					})
					
					.margin({top: 10, right: 10, bottom: 10, left: 10})
					//.showControls(true)        //Allow user to switch between "Grouped" and "Stacked" mode.
					//.stacked(true)
					//.height(height)
					.labelType('percent')
					.labelThreshold(.005)
					chart.donut(true);
					chart.donutRatio(0.50);
					chart.title("Sent");
					//chart.legendPosition("right");

					var color_array = ["#ffbf00","#0e492d","#67aded"];
					// Dynamic yAxis Range
					var upper_lim=0;
					if (scale=='gigabytes') {
						maxVal=maxVal/1000000000;
						upper_lim=Math.floor(maxVal)+2;
					} else if (scale=='megabytes') {
						maxVal=maxVal/1000000;
						upper_lim=Math.floor(maxVal)+10;
					} else if (scale=='kilobytes') {
						maxVal=maxVal/1000;
						upper_lim=Math.floor(maxVal)+100;
					}
					// logging upper_lim
					console.log(upper_lim);
					// Force yAxis range
					//chart.forceY([0,upper_lim]);
					/*chart.color(function(d,i){
						return color_array[i];
					});*/
					chart.color(["#ff7f0e","#102263","#2CA02C", "#d62728","#ffbb78", "#f7fe2e", "#142da9","#636363"]);
					//["#e41a1c", "#377eb8", "#4daf4a", "#984ea3", "#ff7f00", "#ffff33", "#a65628", "#f781bf"]
					
					chart.tooltip.enabled(true);
					// Tooltip formatting for easier readability
					chart.tooltip.contentGenerator(function (d) {
						//var html = "<h3 align='center'>Application: "+d.data.name+"</h3>";
						//var s='';
						//console.log(d.data);
						//console.log(d.data.key);
						//console.log(d.data.value);
						//var key=d.data.key;
						var result=formatBytes(d.data.value);
						var html = "<h5 align='center'>Application: "+d.data.name+"</h5>";
						html+="<p>"+key[0]+": "+result+"</p>";
						return html;
					});
					
					d3.select('#pie2 svg')
						.datum(s)
						.transition().duration(500)
						.call(chart);

					nv.utils.windowResize(chart.update);
					
					/*chart.multibar.dispatch.on("elementClick", function(e) {
						console.log(e);
						console.log($(this));
						console.log(e.data);
						//loadsecondgraph(e.data);
					});*/

					return chart;
					
				});
							
		// Create and load chart with Second dataset
		nv.addGraph(function() {
			var chart = nv.models.pieChart()
				.x(function(d){return d.name;})
				.y(function(d){ 
					switch (scale){
						case 'gigabytes':
							return (d.value/1000000000.0);	//assuming data is in bytes
							break;
						case 'megabytes':
							return (d.value/1000000.0);	//assuming data is in bytes
							break;
						case 'kilobytes':
							return d.value/1000.0; //assuming data is in bytes
							break;
					
					}
				})
				
				.margin({top: 10, right: 10, bottom: 10, left: 10})
				//.showControls(true)        //Allow user to switch between "Grouped" and "Stacked" mode.
				//.stacked(true)
				//.height(height)
				.labelType('percent')
				.labelThreshold(.005)
				chart.donut(true);
				chart.donutRatio(0.50);
				chart.title("Received");

				var color_array = ["#ffbf00","#0e492d","#67aded"];
				// Dynamic yAxis Range
				var upper_lim=0;
				if (scale=='gigabytes') {
					maxVal=maxVal/1000000000;
					upper_lim=Math.floor(maxVal)+2;
				} else if (scale=='megabytes') {
					maxVal=maxVal/1000000;
					upper_lim=Math.floor(maxVal)+10;
				} else if (scale=='kilobytes') {
					maxVal=maxVal/1000;
					upper_lim=Math.floor(maxVal)+100;
				}
				// logging upper_lim
				console.log(upper_lim);
				// Force yAxis range
				//chart.forceY([0,upper_lim]);
				/*chart.color(function(d,i){
					return color_array[i];
				});*/
				chart.color(["#ff7f0e","#102263","#2CA02C", "#d62728","#ffbb78", "#f7fe2e", "#142da9","#636363"]);
				chart.tooltip.enabled(true);
				// Tooltip formatting for easier readability
				chart.tooltip.contentGenerator(function (d) {
					//var html = "<h3 align='center'>Application: "+d.data.name+"</h3>";
					//var s='';
					//console.log(d.data);
					//console.log(d.data.key);
					//console.log(d.data.value);
					//var key=d.data.key;
					var result=formatBytes(d.data.value);
					var html = "<h5 align='center'>Application: "+d.data.name+"</h5>";
					html+="<p>"+key[1]+": "+result+"</p>";
					return html;
				});
				
				d3.select('#pie3 svg')
					.datum(r)
					.transition().duration(500)
					.call(chart);

				nv.utils.windowResize(chart.update);
				
				/*chart.multibar.dispatch.on("elementClick", function(e) {
					console.log(e);
					console.log($(this));
					console.log(e.data);
					//loadsecondgraph(e.data);
				});*/

				return chart;
				
			});
			 /*nv.addGraph(function() {
				var chart = nv.models.multiBarChart()
					.x(function(d) { return d.name; })
					.y(function(d) { 
						switch (scale){
							case 'gigabytes':
								return (d.value/1000000000.0);	//assuming data is in bytes
								break;
							case 'megabytes':
								return (d.value/1000000.0);	//assuming data is in bytes
								break;
							case 'kilobytes':
								return d.value/1000.0; //assuming data is in bytes
								break;
						}
						})
					.margin({top: 30, right: 50, bottom: 60, left: 70})
					.showControls(false)        //Allow user to switch between "Grouped" and "Stacked" mode.
					//.stacked(true)
					//.height(height)
					.reduceXTicks(false)
					.staggerLabels(true); // Stagger labels
					//.rotateLabels(-45); // Or Rotate them 45 degrees

					chart.yAxis
						//.tickFormat(function(d){return milisecondsToComplete(d)}/*d3.format(',.2f'))
						.tickFormat(d3.format(',.2f'))
						.axisLabel('Traffic Volume ('+scale+')');
					chart.xAxis
						.axisLabel('Applications')
						.axisLabelDistance(15);
						//.tickFormat(function(d){return d3.time.format.utc("%Y-%m-%d")(new Date(d));});

					var color_array = ["#ffbf00","#0e492d","#67aded"];
					// Dynamic yAxis Range
					var upper_lim=0;
					if (scale=='gigabytes') {
						maxVal=maxVal/1000000000;
						upper_lim=Math.floor(maxVal)+2;
					} else if (scale=='megabytes') {
						maxVal=maxVal/1000000;
						upper_lim=Math.floor(maxVal)+10;
					} else if (scale=='kilobytes') {
						maxVal=maxVal/1000;
						upper_lim=Math.floor(maxVal)+100;
					}
					// logging upper_lim
					console.log("upper lim chart3=",upper_lim);
					// Force yAxis range
					chart.forceY([0,upper_lim]);
					chart.color(function(d,i){
						return color_array[i];
					});
					chart.color(["#ff7f0e","#102263","#2CA02C", "#d62728","#ffbb78", "#f7fe2e", "#142da9","#636363"]);
					chart.tooltip.enabled(true);
					// Tooltip formatting for easier readability
					chart.tooltip.contentGenerator(function (d) {
						var html = "<h5 align='center'>Application: "+d.data.name+"</h5>";
						var s='';
						//console.log(d.data);
						//console.log(d.data.key);
						//console.log(d.data.value);
						var key=d.data.key;
						var result=formatBytes(d.data.value);
						//console.log(s);
						html+="<p> "+key+": "+result+"</p>";
						return html;
					});
					
					d3.select('#bar3 svg')
						.datum(data)
						.transition().duration(500)
						.call(chart);

					nv.utils.windowResize(chart.update);
					
					chart.multibar.dispatch.on("elementClick", function(e) {
						console.log(e);
						console.log($(this));
						console.log(e.data);
						//loadsecondgraph(e.data);
					});

					return chart;
					
				});*/
			
		});
		
	</script>

</body>

</html>
